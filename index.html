

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flight-pipeline documentation &mdash; Flight-Finder  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Command Line Interface" href="core/cli.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Flight-Finder
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core/cli.html">Command Line Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="core/doc.html">Source Code Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Flight-Finder</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Flight-pipeline documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="flight-pipeline-documentation">
<h1>Flight-pipeline documentation<a class="headerlink" href="#flight-pipeline-documentation" title="Link to this heading"></a></h1>
<p>The CEDA Flight Finder tool allows searching for flights within the CEDA flights index using based on different paramenter parameters. Search for specific flights by Collection, Flight Code, Instrument or Keyword Search, or filter specific flights by temporal geospatial parameters. Flights from FAAM, NERC-ARSF, SAFIRE, AWI-Polar5, Kit-Enduro, and INTA-CASA aircraft and the APEX instrument flown on the DLR aircraft are now included.
Up to the first 1000 flights will be plotted on the map with most recent on top. The default view is the 100 most recent flights.</p>
<p><a class="reference external" href="https://flight-finder.ceda.ac.uk/">The CEDA Flight Finder tool can be accessed here</a></p>
<a class="reference internal image-reference" href="_images/flight-finder-preview.png"><img alt="Screenshot of Flight Finder Interface" class="align-center" src="_images/flight-finder-preview.png" style="width: 80%;" />
</a>
<br><br><div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core/cli.html">Command Line Tool</a><ul>
<li class="toctree-l2"><a class="reference internal" href="core/cli.html#instructions">Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="core/cli.html#usage-flight-pipeline-options-command-args">Usage: flight-pipeline [OPTIONS] COMMAND [ARGS]…</a></li>
<li class="toctree-l2"><a class="reference internal" href="core/cli.html#usage-flight-pipeline-flight-update-options">Usage: flight-pipeline flight-update [OPTIONS]</a></li>
<li class="toctree-l2"><a class="reference internal" href="core/cli.html#options">Options:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="core/doc.html">Source Code Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="core/doc.html#project-description">Project description</a></li>
<li class="toctree-l2"><a class="reference internal" href="core/doc.html#module-flight_update">Flight Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="core/doc.html#module-flight_client">Elastic Search Flight Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="core/doc.html#module-simple_client">Flight Client Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="core/doc.html#module-write_flights">Write Flights</a></li>
<li class="toctree-l2"><a class="reference internal" href="core/doc.html#module-moles">Get Moles</a></li>
</ul>
</li>
</ul>
</div>
<p>Repository for python code to concatenate data sources and construct new flight records for CEDA flight-finder</p>
<section id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Link to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Mechanism for uploading new flights to stac index</p></li>
<li><p>Use ES Client to determine array of ids that currently exists in the index</p></li>
<li><p>Push new records that are not currently in the index</p></li>
<li><p>Remove or archive pushed records on local system</p></li>
</ul>
</div></blockquote>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Clone the repository from github</p></li>
<li><dl class="simple">
<dt>Install requirements into a local virtual environment:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">local</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">local/bin/activate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Configure dirconfig with relative paths</p></li>
</ul>
</div></blockquote>
</section>
<section id="running-the-program">
<h2>Running the program<a class="headerlink" href="#running-the-program" title="Link to this heading"></a></h2>
<p><strong>1. Use stac_template to write new records</strong>
Follow the STAC template json file to create new flight records (more details further down)</p>
<p><strong>2. Configure dirconfig file</strong>
Add on lines 2 and 4 the directory paths to where your new flights to push are stored, and where the pushed flights should go once they have been uploaded to the index (store them or write DELETE to remove them from the local system)</p>
<p><strong>3. Push New Flights</strong>
Run with command <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">flight_update.py</span> <span class="pre">add</span></code> with a filled in dirconfig file to push new records to the index</p>
</section>
<section id="update-existing-flights">
<h2>Update Existing Flights<a class="headerlink" href="#update-existing-flights" title="Link to this heading"></a></h2>
<p>Note: In case of repair or adjustment to existing records, the individual records can be updated in place.</p>
<p>Run with command <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">flight_update.py</span> <span class="pre">update</span> <span class="pre">&lt;pyfile&gt;</span></code>, where <em>pyfile</em> is a python file containing an <em>update</em> function that can be applied to each record in elasticsearch.</p>
</section>
<section id="stac-template">
<h2>STAC Template<a class="headerlink" href="#stac-template" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>From the template, the following should be filled in:</dt><dd><ul class="simple">
<li><p>id (fnum/pcode * date)</p></li>
<li><p>es_id (random string of ASCII characters to generate one of 9 colours in flight finder)</p></li>
<li><p>description_path</p></li>
<li><p>collection</p></li>
<li><p>geometry.display.coordinates</p></li>
<li><p>geometry.display.type (if coordinates are not MultiLineString)</p></li>
<li><dl class="simple">
<dt>properties:</dt><dd><ul>
<li><p>data_format</p></li>
<li><p>start_datetime</p></li>
<li><p>end_datetime</p></li>
<li><p>flight_num (if applicable)</p></li>
<li><p>pcode (if applicable)</p></li>
<li><p>aircraft</p></li>
<li><p>variables</p></li>
<li><p>location</p></li>
<li><p>platform</p></li>
<li><p>instruments</p></li>
<li><p>pi</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="geometries-development">
<h1>Geometries Development<a class="headerlink" href="#geometries-development" title="Link to this heading"></a></h1>
<p>Correct Version of mapping that exists in the arsf index</p>
<div class="highlight-json-object notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;spatial&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;geometries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;display&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;coordinates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;double&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">                  </span><span class="p">},</span>
<span class="w">                  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nt">&quot;keyword&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                           </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
<span class="w">                           </span><span class="nt">&quot;ignore_above&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                     </span><span class="p">}</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;full_search&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;geo_shape&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;search&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;geo_shape&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Incorrect version currently in <code class="docutils literal notranslate"><span class="pre">stac-flightfinder-items</span></code></p>
<div class="highlight-json-object notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;geometry&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;properties&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;display&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;properties&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;coordinates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;float&quot;</span>
<span class="w">         </span><span class="p">},</span>
<span class="w">         </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;fields&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;keyword&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;ignore_above&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">256</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;geometries&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;properties&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;display&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;properties&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;coordinates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;float&quot;</span>
<span class="w">               </span><span class="p">},</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;fields&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;keyword&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="nt">&quot;ignore_above&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">256</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">},</span>
<span class="w">         </span><span class="nt">&quot;search&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;properties&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;coordinates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;float&quot;</span>
<span class="w">               </span><span class="p">},</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;fields&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;keyword&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                     </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="nt">&quot;ignore_above&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">256</span>
<span class="w">                  </span><span class="p">}</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;search&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;properties&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;coordinates&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;float&quot;</span>
<span class="w">         </span><span class="p">},</span>
<span class="w">         </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;fields&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;keyword&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;ignore_above&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">256</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="ammendments">
<h2>Ammendments:<a class="headerlink" href="#ammendments" title="Link to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Remove <strong>geometries</strong> subfield.</p></li>
<li><p>Remove all subfields of <strong>search</strong> and just add <code class="docutils literal notranslate"><span class="pre">&quot;type&quot;:&quot;geo_shape&quot;</span></code>.</p></li>
<li><p>Add <strong>full_search</strong> sub_field with <code class="docutils literal notranslate"><span class="pre">&quot;type&quot;:&quot;geo_shape&quot;</span></code>.</p></li>
</ul>
</div></blockquote>
<a class="reference internal image-reference" href="_images/ceda.png"><img alt="CEDA Logo" src="_images/ceda.png" style="width: 300px;" />
</a>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="core/cli.html" class="btn btn-neutral float-right" title="Command Line Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>